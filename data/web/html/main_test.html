<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Y_CHECK 메인 페이지 테스트</title>
    <style>
        body {
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
          padding: 24px;
          background: #f5f7fb;
        }
        h1 {
          margin-bottom: 16px;
        }
        .card {
          background: #fff;
          border-radius: 12px;
          padding: 16px 20px;
          margin-bottom: 16px;
          box-shadow: 0 2px 4px rgba(15, 23, 42, 0.06);
        }
        .row {
          display: flex;
          gap: 16px;
          margin-bottom: 16px;
        }
        .row > .card {
          flex: 1;
        }
        .progress-bar {
          width: 100%;
          height: 12px;
          border-radius: 999px;
          background: #e5e7eb;
          overflow: hidden;
          margin-top: 8px;
        }
        .progress-bar-inner {
          height: 100%;
          background: linear-gradient(90deg, #60a5fa, #2563eb);
          width: 0%;
          transition: width 0.4s ease;
        }
        .overall-score {
          font-size: 32px;
          font-weight: 700;
        }
        .muted {
          color: #6b7280;
          font-size: 14px;
        }
        .badge {
          display: inline-block;
          padding: 2px 8px;
          border-radius: 999px;
          background: #eff6ff;
          color: #1d4ed8;
          font-size: 12px;
          margin-left: 4px;
        }
        ul.grade-list {
          list-style: none;
          padding-left: 0;
          margin: 0;
        }
        ul.grade-list li {
          display: flex;
          justify-content: space-between;
          padding: 2px 0;
          font-size: 14px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          font-size: 14px;
        }
        th, td {
          padding: 6px 4px;
          border-bottom: 1px solid #e5e7eb;
          text-align: left;
        }
        th {
          background: #f9fafb;
          font-weight: 600;
        }
        .track-title {
          font-size: 18px;
          margin-bottom: 4px;
        }
        .track-title span {
          color: #16a34a;
          font-weight: 700;
        }
        button {
          padding: 6px 12px;
          border-radius: 999px;
          border: none;
          background: #2563eb;
          color: white;
          font-size: 14px;
          cursor: pointer;
          margin-bottom: 16px;
        }
        button:disabled {
          opacity: 0.6;
          cursor: default;
        }
        pre#raw {
          font-size: 12px;
          background: #0f172a;
          color: #e5e7eb;
          padding: 8px;
          border-radius: 8px;
          overflow-x: auto;
        }
        .user-name {
          font-size: 18px;
          font-weight: 700;
          margin-bottom: 4px;
        }
        .right-column {
          display: flex;
          flex-direction: column;
          gap: 16px;
          max-width: 280px;
        }
        .memo-box {
          white-space: pre-line;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          padding: 8px 10px;
          background: #f9fafb;
          font-size: 14px;
        }
    </style>
</head>
<body>
<h1>Y_CHECK 메인 페이지 (API 연동 테스트)</h1>
<button id="reloadBtn">데이터 새로고침</button>

<!-- 첫 줄: 전체 진행도 + 내 정보 -->
<div class="row">
    <div class="card">
        <div class="muted">총 이수 진행도</div>
        <div>
            <span class="overall-score" id="overall-text">- / - 점</span>
            <span class="badge" id="overall-rate">0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-bar-inner" id="overall-bar"></div>
        </div>
    </div>

    <div class="card" style="max-width: 280px;">
        <div class="muted" style="text-align:right;">베타</div>
        <div class="user-name" id="user-name">-님</div>
        <div class="muted" id="user-id-year">-</div>
        <div class="muted" id="user-dept">-</div>
    </div>
</div>

<!-- 성적 비율 + 분류별 이수 -->
<div class="row">
    <!-- 성적 비율 -->
    <div class="card">
        <div class="muted">성적 비율 (원그래프용 데이터)</div>
        <ul class="grade-list" id="grade-list">
            <!-- JS로 채워짐 -->
        </ul>
    </div>

    <!-- 분류별 이수 학점 -->
    <div class="card">
        <div class="muted">이수 학점 (분류별)</div>
        <table>
            <thead>
            <tr>
                <th>분류</th>
                <th>이수</th>
                <th>전체</th>
                <th>진행률</th>
            </tr>
            </thead>
            <tbody id="category-body">
            <!-- JS로 채워짐 -->
            </tbody>
        </table>
    </div>
</div>

<!-- 트랙 추천 -->
<div class="card">
    <div class="muted">트랙 추천</div>
    <div class="track-title" id="track-title">추천 트랙: -</div>
    <div class="muted" id="track-message"></div>

    <h4 style="margin-top: 12px;">추천 이수 과목 리스트</h4>
    <table>
        <thead>
        <tr>
            <th>우선순위</th>
            <th>과목명</th>
            <th>분류</th>
            <th>학점</th>
        </tr>
        </thead>
        <tbody id="track-course-body">
        <!-- JS로 채워짐 -->
        </tbody>
    </table>
</div>

<!-- 수강 과목 + 채플 + 메모 -->
<div class="row">
    <!-- 수강 과목 리스트 -->
    <div class="card">
        <div class="muted">수강 과목 리스트 (이번 학기)</div>
        <table>
            <thead>
            <tr>
                <th>과목명</th>
                <th>분류</th>
                <th>학점</th>
            </tr>
            </thead>
            <tbody id="current-courses-body">
            <!-- JS로 채워짐 -->
            </tbody>
        </table>
    </div>

    <!-- 오른쪽: 채플 + 메모 -->
    <div class="right-column">
        <div class="card">
            <div class="muted">채플 카운트</div>
            <div>
                <span id="chapel-count">0 / 0</span>
                <span class="badge" id="chapel-rate">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-inner" id="chapel-bar"></div>
            </div>
        </div>

        <div class="card">
            <div class="muted">졸업 요구사항 (메모)</div>
            <div class="memo-box" id="memo-box"></div>
        </div>
    </div>
</div>

<!-- 디버깅용 원본 JSON -->
<div class="card">
    <div class="muted">원본 JSON (디버깅용)</div>
    <pre id="raw"></pre>
</div>

<script>
    async function loadMain() {
      const btn = document.getElementById("reloadBtn");
      btn.disabled = true;
      btn.textContent = "불러오는 중...";

      try {
        const res = await fetch("/api/main/summary/");
        const data = await res.json();

        // 1) 전체 진행도
        const o = data.overall;
        document.getElementById("overall-text").textContent =
          `${o.earned_credits} / ${o.total_credits} 점`;
        document.getElementById("overall-rate").textContent = `${o.rate}%`;
        document.getElementById("overall-bar").style.width = `${o.rate}%`;

        // 2) 내 정보 카드
        const u = data.user_info;
        document.getElementById("user-name").textContent = `${u.name}님`;
        document.getElementById("user-id-year").textContent =
          `${u.student_id} / ${u.year}학년`;
        document.getElementById("user-dept").textContent = u.department;

        // 3) 성적 비율
        const gradeList = document.getElementById("grade-list");
        gradeList.innerHTML = "";
        const grades = data.grade_distribution;
        Object.keys(grades).forEach(key => {
          const g = grades[key];
          const li = document.createElement("li");
          li.innerHTML = `<span>${g.label}</span><span>${g.rate}%</span>`;
          gradeList.appendChild(li);
        });

        // 4) 분류별 이수 진행도
        const catBody = document.getElementById("category-body");
        catBody.innerHTML = "";
        data.category_progress.forEach(c => {
          const rate = c.total === 0 ? 0 : Math.round(c.taken / c.total * 100);
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${c.name}</td>
            <td>${c.taken}</td>
            <td>${c.total}</td>
            <td>${rate}%</td>
          `;
          catBody.appendChild(tr);
        });

        // 5) 트랙 추천
        const trk = data.track_recommendation;
        document.getElementById("track-title").innerHTML =
          `추천 트랙: <span>${trk.track_name}</span>`;
        document.getElementById("track-message").textContent = trk.message;

        const trackBody = document.getElementById("track-course-body");
        trackBody.innerHTML = "";
        trk.courses.forEach(c => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${c.priority}</td>
            <td>${c.name}</td>
            <td>${c.type}</td>
            <td>${c.credit}</td>
          `;
          trackBody.appendChild(tr);
        });

        // 6) 현재 학기 수강 과목
        const courseBody = document.getElementById("current-courses-body");
        courseBody.innerHTML = "";
        data.current_courses.forEach(c => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${c.name}</td>
            <td>${c.type}</td>
            <td>${c.credit}</td>
          `;
          courseBody.appendChild(tr);
        });

        // 7) 채플 카운트
        const ch = data.chapel;
        document.getElementById("chapel-count").textContent =
          `${ch.taken} / ${ch.required}`;
        document.getElementById("chapel-rate").textContent =
          `${ch.rate}%`;
        document.getElementById("chapel-bar").style.width =
          `${ch.rate}%`;

        // 8) 졸업 요구사항 메모
        document.getElementById("memo-box").textContent = data.memo;

        // 9) 디버깅용 RAW JSON
        document.getElementById("raw").textContent =
          JSON.stringify(data, null, 2);
      } catch (e) {
        alert("API 호출 중 오류: " + e);
      } finally {
        btn.disabled = false;
        btn.textContent = "데이터 새로고침";
      }
    }

    document.getElementById("reloadBtn").addEventListener("click", loadMain);

    // 페이지 열리면 자동 한 번 호출
    loadMain();
</script>
</body>
</html>
