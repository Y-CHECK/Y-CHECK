<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Y_CHECK 시간표 테스트</title>
</head>
<body>
<h1>Y_CHECK 시간표(API 테스트)</h1>

<button id="loadBtn">이번 학기 시간표 불러오기</button>

<h2 id="title">로딩 전</h2>

<table border="1" cellspacing="0" cellpadding="4">
    <thead>
    <tr>
        <th>요일</th>
        <th>교시</th>
        <th>과목 코드</th>
        <th>과목명</th>
    </tr>
    </thead>
    <tbody id="tableBody">
    <!-- JS로 채움 -->
    </tbody>
</table>

<pre id="raw" style="margin-top:16px; background:#f5f5f5; padding:8px;"></pre>

<script>
    async function loadTimetable() {
      const titleEl = document.getElementById("title");
      const bodyEl = document.getElementById("tableBody");
      const rawEl = document.getElementById("raw");

      titleEl.textContent = "로딩 중...";
      bodyEl.innerHTML = "";
      rawEl.textContent = "";

      try {
        const res = await fetch("/api/timetable/current/");
        const data = await res.json();

        titleEl.textContent = `${data.year}년 ${data.semester} 학기 시간표`;

        data.grid.forEach(col => {
          const day = col.day;
          col.slots.forEach(slot => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${day}</td>
              <td>${slot.period}</td>
              <td>${slot.code}</td>
              <td>${slot.title}</td>
            `;
            bodyEl.appendChild(tr);
          });
        });

        rawEl.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        titleEl.textContent = "에러 발생: " + e;
      }
    }

    document.getElementById("loadBtn").addEventListener("click", loadTimetable);
</script>
</body>
</html>
