<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Y_CHECK Â· ì‹œê°„í‘œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-[#f7f9fc] text-slate-900 pb-24">

<!-- ê³µí†µ í—¤ë” -->
<header class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">

        <!-- 1. ë¡œê³  (ì¢Œì¸¡) -->
        <div class="flex items-center gap-3">
            <a href="main.html" class="flex items-center gap-3">
                <img src="../img/ycheck_logo.png" alt="Y_CHECK ë¡œê³ " class="h-8 w-auto">
            </a>
        </div>

        <!-- 2. ë‚´ë¹„ê²Œì´ì…˜ -->
        <nav class="hidden sm:flex items-center justify-center flex-1 divide-x divide-slate-300" style="margin-left: 90px;">
            <a href="calculator.html" class="px-6 py-2 text-sm text-slate-600 hover:text-slate-900 font-bold">ê³„ì‚°ê¸°</a>
            <a href="timetable.html" class="px-6 py-2 text-sm text-slate-900 font-bold">ì‹œê°„í‘œ</a>
            <a href="sunbae.html" class="px-6 py-2 text-sm text-slate-600 hover:text-slate-900 font-bold">ì„ ë°°ì˜ ë°œìì·¨</a>
        </nav>

        <!-- 3. ë§ˆì´í˜ì´ì§€ ë²„íŠ¼ (ìš°ì¸¡) -->
        <div class="hidden sm:block">
            <a href="mypage.html" class="px-6 py-2 text-sm text-slate-600 hover:text-slate-900 font-bold">ë§ˆì´í˜ì´ì§€</a>
        </div>
    </div>
</header>

<main class="max-w-7xl mx-auto px-4 sm:px-6 py-8 grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- ë©”ì¸ ì‹œê°„í‘œ -->
    <section class="lg:col-span-9 bg-white rounded-2xl border shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
            <!-- ğŸ”¹ ë™ì ìœ¼ë¡œ ë°”ê¿€ íƒ€ì´í‹€ -->
            <h1 id="timetableTitle" class="text-2xl font-bold">ì‹œê°„í‘œ</h1>

            <!-- ğŸ”¹ í•™ê¸° ì„ íƒ ë“œë¡­ë‹¤ìš´ (APIë¡œ ì±„ì›€) -->
            <select id="semesterSelect" class="rounded-xl border px-3 py-2 text-sm">
                <option value="">í•™ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>

        <div class="h-px bg-slate-200 mb-4"></div>

        <div class="overflow-x-auto">
            <table class="min-w-full text-sm text-center">
                <thead>
                <tr class="text-slate-600">
                    <th class="py-2 w-20">êµì‹œ</th>
                    <th class="py-2">ì›”</th>
                    <th class="py-2">í™”</th>
                    <th class="py-2">ìˆ˜</th>
                    <th class="py-2">ëª©</th>
                    <th class="py-2">ê¸ˆ</th>
                </tr>
                </thead>
                <tbody>
                <tr class="border-t" data-period="1">
                    <td class="py-3 text-slate-500">1êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="1"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="1"></td>
                    <td class="timetable-cell" data-day="WED" data-period="1"></td>
                    <td class="timetable-cell" data-day="THU" data-period="1"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="1"></td>
                </tr>
                <tr class="border-t" data-period="2">
                    <td class="py-3 text-slate-500">2êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="2"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="2"></td>
                    <td class="timetable-cell" data-day="WED" data-period="2"></td>
                    <td class="timetable-cell" data-day="THU" data-period="2"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="2"></td>
                </tr>
                <tr class="border-t" data-period="3">
                    <td class="py-3 text-slate-500">3êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="3"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="3"></td>
                    <td class="timetable-cell" data-day="WED" data-period="3"></td>
                    <td class="timetable-cell" data-day="THU" data-period="3"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="3"></td>
                </tr>
                <tr class="border-t" data-period="4">
                    <td class="py-3 text-slate-500">4êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="4"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="4"></td>
                    <td class="timetable-cell" data-day="WED" data-period="4"></td>
                    <td class="timetable-cell" data-day="THU" data-period="4"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="4"></td>
                </tr>
                <tr class="border-t" data-period="5">
                    <td class="py-3 text-slate-500">5êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="5"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="5"></td>
                    <td class="timetable-cell" data-day="WED" data-period="5"></td>
                    <td class="timetable-cell" data-day="THU" data-period="5"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="5"></td>
                </tr>
                <tr class="border-t" data-period="6">
                    <td class="py-3 text-slate-500">6êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="6"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="6"></td>
                    <td class="timetable-cell" data-day="WED" data-period="6"></td>
                    <td class="timetable-cell" data-day="THU" data-period="6"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="6"></td>
                </tr>
                <tr class="border-t" data-period="7">
                    <td class="py-3 text-slate-500">7êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="7"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="7"></td>
                    <td class="timetable-cell" data-day="WED" data-period="7"></td>
                    <td class="timetable-cell" data-day="THU" data-period="7"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="7"></td>
                </tr>
                <tr class="border-t" data-period="8">
                    <td class="py-3 text-slate-500">8êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="8"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="8"></td>
                    <td class="timetable-cell" data-day="WED" data-period="8"></td>
                    <td class="timetable-cell" data-day="THU" data-period="8"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="8"></td>
                </tr>
                <tr class="border-t" data-period="9">
                    <td class="py-3 text-slate-500">9êµì‹œ</td>
                    <td class="timetable-cell" data-day="MON" data-period="9"></td>
                    <td class="timetable-cell" data-day="TUE" data-period="9"></td>
                    <td class="timetable-cell" data-day="WED" data-period="9"></td>
                    <td class="timetable-cell" data-day="THU" data-period="9"></td>
                    <td class="timetable-cell" data-day="FRI" data-period="9"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- ì˜¤ë¥¸ìª½: ì»¨íŠ¸ë¡¤ / ë‹´ì€ ìˆ˜ì—… / ì‹œê°„í‘œ ê³µìœ  -->
    <aside class="lg:col-span-3 space-y-4">
        <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ -->
        <div class="bg-white rounded-2xl border shadow-sm p-4 space-y-3">
            <button id="openSearchModalButton"
                    class="w-full text-left border rounded-xl px-3 py-2 text-sm">
                + ìˆ˜ì—… ëª©ë¡ì—ì„œ ê²€ìƒ‰í•´ì„œ ì¶”ê°€í•˜ê¸°
            </button>
            <button id="openNewTimetableModalButton"
                    class="w-full text-left border rounded-xl px-3 py-2 text-sm">
                + ìƒˆ ì‹œê°„í‘œ ë§Œë“¤ê¸°
            </button>
        </div>

        <!-- ë‹´ì€ ìˆ˜ì—… ë°•ìŠ¤ (ìœ„) -->
        <div class="bg-white rounded-2xl border shadow-sm p-5">
            <div class="text-lg font-semibold mb-2">ë‹´ì€ ìˆ˜ì—…</div>
            <div class="h-px bg-slate-200 mb-3"></div>
            <ul class="space-y-2 text-sm">
                <li class="flex items-center justify-between">
                    <span class="font-medium">ë°ì´í„°êµ¬ì¡°ë¡ </span>
                    <span class="text-slate-500">ì›”3, ìˆ˜4</span>
                </li>
                <!-- TODO: ë‚˜ì¤‘ì— ì‹¤ì œ ë‹´ì€ ìˆ˜ì—… ë°ì´í„°ë¡œ êµì²´ ê°€ëŠ¥ -->
            </ul>
        </div>

        <!-- ì„ ë°°ì˜ ë°œìì·¨ì— ì‹œê°„í‘œ ê³µìœ  (ì²´í¬ë°•ìŠ¤ ë°©ì‹) -->
        <div class="bg-white rounded-2xl border shadow-sm p-5">
            <div class="text-lg font-semibold mb-2">ì„ ë°°ì˜ ë°œìì·¨ì— ì‹œê°„í‘œ ê³µìœ </div>
            <div class="h-px bg-slate-200 mb-3"></div>

            <!-- ì²´í¬ UI -->
            <label class="flex items-center gap-3 text-sm cursor-pointer select-none">
                <input
                        id="chk-share-timetable"
                        type="checkbox"
                        class="w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"
                />
                <span class="font-medium text-slate-800">ë‚´ ì‹œê°„í‘œ ê³µìœ í•˜ê¸°</span>
            </label>

            <p class="mt-2 text-xs text-slate-500">
                ì²´í¬í•˜ë©´ ë‚´ ì‹œê°„í‘œê°€ í›„ë°°ë“¤ì—ê²Œ ê³µê°œë©ë‹ˆë‹¤.
            </p>
        </div>
    </aside>
</main>

<!-- ==== ê³µí†µ í‘¸í„° + ëª¨ë‹¬ + ìŠ¤í¬ë¦½íŠ¸ ==== -->
<footer class="absolute bottom-0 inset-x-0 bg-white border-t w-full">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-start justify-between">
        <div class="flex items-start gap-4">
            <div class="space-y-0.5 text-sm text-slate-600 leading-tight">
                <div>Inc: ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì›ì£¼ì‹œ í¥ì—…ë©´ ì—°ì„¸ëŒ€ê¸¸ 1</div>
                <div>Tel: 033-123-4567</div>
                <div>Email: YCHECK@gmail.com</div>
            </div>
        </div>
        <div class="flex items-center gap-6 text-sm text-slate-600 leading-tight" style="margin-top: 12px;">
            <span class="hidden sm:block h-6 w-px bg-slate-200"></span>
            <a href="#" class="text-xs text-blak-600 hover:underline" id="open-makers-modal"><span>ë§Œë“ ì´ë“¤</span></a>
            <a href="#" class="text-xs text-black-600 hover:underline" id="open-contact-modal"><span>ë¬¸ì˜í•˜ê¸°</span></a>
        </div>
    </div>
</footer>

<!-- ë§Œë“ ì´ë“¤ ëª¨ë‹¬ -->
<div id="makers-modal-overlay"
     class="fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50 hidden">
    <div class="bg-white rounded-2xl px-6 py-8 w-full max-w-md shadow-xl relative">
        <button id="close-makers-modal"
                class="absolute top-3 right-3 text-slate-500 hover:text-slate-700 text-2xl font-bold"
                aria-label="ë‹«ê¸°">&times;</button>
        <h2 class="text-xl font-bold mb-4 text-center">ë§Œë“ ì´ë“¤</h2>
        <div class="space-y-2 text-sm text-slate-700">
            <div><strong>í™ê¸¸ë™</strong> â€“ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ, UI/UX ë””ìì¸</div>
            <div><strong>ê¹€ì˜í¬</strong> â€“ ë°±ì—”ë“œ ê°œë°œ, DB ì„¤ê³„</div>
            <div><strong>ë°•ì² ìˆ˜</strong> â€“ ê¸°íš, ë¬¸ì„œí™”, QA</div>
            <hr class="my-2">
            <div class="text-xs text-slate-500">
                Y_CHECK ì„œë¹„ìŠ¤ëŠ” ìœ„ íŒ€ì›ì´ í•¨ê»˜ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.<br>
                ê¶ê¸ˆí•œ ì ì€ ì–¸ì œë“  ë¬¸ì˜í•´ ì£¼ì„¸ìš”!
            </div>
        </div>
    </div>
</div>

<!-- ë¬¸ì˜í•˜ê¸° ëª¨ë‹¬ -->
<div id="contact-modal-overlay"
     class="fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50 hidden">
    <div class="bg-white rounded-2xl px-6 py-8 w-full max-w-md shadow-xl relative">
        <button id="close-contact-modal"
                class="absolute top-3 right-3 text-slate-500 hover:text-slate-700 text-2xl font-bold"
                aria-label="ë‹«ê¸°">&times;</button>
        <h2 class="text-xl font-bold mb-5 text-center">ë¬¸ì˜í•˜ê¸°</h2>
        <form class="space-y-4" id="contact-form" autocomplete="off">
            <div>
                <label for="inquiry-type" class="block text-sm mb-1 font-medium text-slate-700">ë¬¸ì˜ ìœ í˜•</label>
                <select id="inquiry-type" name="inquiry-type" class="w-full rounded-xl border px-3 py-2 text-sm">
                    <option value="" selected disabled>ë¬¸ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ê³„ì •">ê³„ì • ê´€ë ¨</option>
                    <option value="ë¶ˆí¸">ì´ìš© ë¶ˆí¸</option>
                    <option value="ê±´ì˜">ê¸°ëŠ¥ ê±´ì˜</option>
                    <option value="ì˜¤ë¥˜">ë²„ê·¸/ì˜¤ë¥˜ ì‹ ê³ </option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€(ì§ì ‘ì…ë ¥)</option>
                </select>
            </div>
            <div id="custom-type-wrap" class="hidden">
                <input type="text" id="custom-type"
                       class="w-full rounded-xl border px-3 py-2 text-sm mt-2"
                       placeholder="ë¬¸ì˜ ì¢…ë¥˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div>
                <label for="inquiry-content" class="block text-sm mb-1 font-medium text-slate-700">ë¬¸ì˜ ë‚´ìš©</label>
                <textarea id="inquiry-content" name="inquiry-content"
                          rows="4"
                          class="w-full rounded-xl border px-3 py-2 text-sm resize-none"
                          placeholder="ë¬¸ì˜í•˜ì‹¤ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”."
                          required></textarea>
            </div>
            <button type="submit"
                    class="w-full rounded-xl bg-blue-700 text-white py-2 text-sm font-semibold mt-2">
                ë¬¸ì˜ ì ‘ìˆ˜í•˜ê¸°
            </button>
        </form>
        <div id="contact-success" class="hidden mt-4 text-green-600 text-sm text-center font-semibold">
            ë¬¸ì˜ê°€ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
    </div>
</div>

<!-- íŒì—… ì˜¤ë²„ë ˆì´ (ìˆ˜ì—… ëª©ë¡ ê²€ìƒ‰) -->
<div id="searchModalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <h3 class="text-lg font-bold">ìˆ˜ì—… ëª©ë¡ì—ì„œ ì¶”ê°€í•˜ê¸°</h3>
            <button id="closeSearchModal" class="text-slate-500 hover:text-slate-800 text-2xl leading-none">&times;</button>
        </div>

        <div class="space-y-4">
            <!-- ê²€ìƒ‰ì°½ -->
            <div class="flex gap-2">
                <input
                        id="courseSearchInput"
                        type="text"
                        class="flex-1 rounded-lg border px-3 py-2 text-sm"
                        placeholder="ê³¼ëª©ëª… ë˜ëŠ” êµìˆ˜ëª…ìœ¼ë¡œ ê²€ìƒ‰"
                />
                <button
                        id="courseSearchButton"
                        class="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold"
                >
                    ê²€ìƒ‰
                </button>
            </div>

            <!-- ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ -->
            <div
                    id="courseSearchResults"
                    class="max-h-80 overflow-y-auto divide-y divide-slate-200 text-sm"
            >
                <!-- JSë¡œ ì±„ì›Œì§ -->
            </div>
        </div>
    </div>
</div>

<!-- íŒì—… ì˜¤ë²„ë ˆì´ (ìƒˆ ì‹œê°„í‘œ) -->
<div id="newTimetableModalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <h3 class="text-lg font-bold">ìƒˆ ì‹œê°„í‘œ</h3>
            <button id="closeNewTimetableModal" class="text-slate-500 hover:text-slate-800 text-2xl leading-none">&times;</button>
        </div>
        <div class="space-y-4">
            <div class="flex items-center justify-center text-xl font-bold">
                <div class="flex items-center">
                    <input type="number" id="yearInput" value="2025" min="1900" max="2100" class="w-20 text-center border-none focus:ring-0 text-xl font-bold" />
                </div>
                <span class="mx-2">ë…„</span>
                <div class="flex items-center">
                    <input type="number" id="semesterInput" value="2" min="1" max="2" class="w-12 text-center border-none focus:ring-0 text-xl font-bold" />
                </div>
                <span class="ml-2">í•™ê¸°</span>
            </div>
            <div class="flex justify-center mt-4">
                <button id="createTimetableButton" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">ì‹œê°„í‘œ ìƒì„±</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ====== localStorage í‚¤ ======
    const STORAGE_KEY_YEAR = "timetable_last_year";
    const STORAGE_KEY_SEMESTER = "timetable_last_semester";

    // ë§Œë“ ì´ë“¤ ëª¨ë‹¬
    const openMakersBtn = document.getElementById('open-makers-modal');
    const makersModal = document.getElementById('makers-modal-overlay');
    const closeMakersBtn = document.getElementById('close-makers-modal');
    if (openMakersBtn && makersModal && closeMakersBtn) {
        openMakersBtn.addEventListener('click', function(e) {
            e.preventDefault();
            makersModal.classList.remove('hidden');
        });
        closeMakersBtn.addEventListener('click', function() {
            makersModal.classList.add('hidden');
        });
        makersModal.addEventListener('click', function(e) {
            if (e.target === makersModal) makersModal.classList.add('hidden');
        });
        document.addEventListener('keydown', function(e) {
            if (!makersModal.classList.contains('hidden') && e.key === 'Escape')
                makersModal.classList.add('hidden');
        });
    }

    // ë¬¸ì˜í•˜ê¸° ëª¨ë‹¬
    const openContactBtn = document.getElementById('open-contact-modal');
    const contactModal = document.getElementById('contact-modal-overlay');
    const closeContactBtn = document.getElementById('close-contact-modal');
    if (openContactBtn && contactModal && closeContactBtn) {
        openContactBtn.addEventListener('click', function(e) {
            e.preventDefault();
            contactModal.classList.remove('hidden');
        });
        closeContactBtn.addEventListener('click', function() {
            contactModal.classList.add('hidden');
        });
        contactModal.addEventListener('click', function(e) {
            if (e.target === contactModal) contactModal.classList.add('hidden');
        });
        document.addEventListener('keydown', function(e) {
            if (!contactModal.classList.contains('hidden') && e.key === 'Escape')
                contactModal.classList.add('hidden');
        });

        // ë¬¸ì˜ ì¢…ë¥˜ ê¸°íƒ€ ì…ë ¥
        const inquiryType = document.getElementById('inquiry-type');
        const customTypeWrap = document.getElementById('custom-type-wrap');
        const customTypeInput = document.getElementById('custom-type');
        if (inquiryType && customTypeWrap && customTypeInput) {
            inquiryType.addEventListener('change', function () {
                if (this.value === 'ê¸°íƒ€') {
                    customTypeWrap.classList.remove('hidden');
                    customTypeInput.setAttribute('required', 'required');
                } else {
                    customTypeWrap.classList.add('hidden');
                    customTypeInput.value = '';
                    customTypeInput.removeAttribute('required');
                }
            });
        }

        // ë¬¸ì˜í¼ ì œì¶œ ì²˜ë¦¬(ì˜ˆì‹œ)
        const contactForm = document.getElementById('contact-form');
        const contactSuccess = document.getElementById('contact-success');
        const customTypeWrap2 = document.getElementById('custom-type-wrap');
        if (contactForm && contactSuccess) {
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                contactForm.classList.add('hidden');
                contactSuccess.classList.remove('hidden');
                setTimeout(() => {
                    contactModal.classList.add('hidden');
                    contactForm.reset();
                    contactForm.classList.remove('hidden');
                    customTypeWrap2.classList.add('hidden');
                    contactSuccess.classList.add('hidden');
                }, 1800);
            });
        }
    }

    // ì˜¤ë¥¸ìª½ ìƒë‹¨ ì»¨íŠ¸ë¡¤ ëª¨ë‹¬
    const openSearchModalButton = document.getElementById('openSearchModalButton');
    const openNewTimetableModalButton = document.getElementById('openNewTimetableModalButton');

    const searchModalOverlay = document.getElementById('searchModalOverlay');
    const closeSearchModalButton = document.getElementById('closeSearchModal');

    const newTimetableModalOverlay = document.getElementById('newTimetableModalOverlay');
    const closeNewTimetableModalButton = document.getElementById('closeNewTimetableModal');

    const createTimetableButton = document.getElementById('createTimetableButton');
    const yearInput = document.getElementById('yearInput');
    const semesterInput = document.getElementById('semesterInput');

    // ìˆ˜ì—… ê²€ìƒ‰ ëª¨ë‹¬ ë‚´ë¶€ ìš”ì†Œ
    const courseSearchInput = document.getElementById('courseSearchInput');
    const courseSearchButton = document.getElementById('courseSearchButton');
    const courseSearchResults = document.getElementById('courseSearchResults');

    if (openSearchModalButton && searchModalOverlay && closeSearchModalButton) {
        openSearchModalButton.addEventListener('click', () => {
            if (!currentYear || !currentSemester) {
                alert('ë¨¼ì € ìƒë‹¨ì—ì„œ í•™ê¸°ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                return;
            }
            searchModalOverlay.classList.remove('hidden');
            searchModalOverlay.classList.add('flex');

            // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ê¸°ë³¸ ë¦¬ìŠ¤íŠ¸ ë¡œë”©
            if (courseSearchInput) courseSearchInput.value = '';
            searchCourses();
        });
        closeSearchModalButton.addEventListener('click', () => {
            searchModalOverlay.classList.add('hidden');
            searchModalOverlay.classList.remove('flex');
        });
        searchModalOverlay.addEventListener('click', (e) => {
            if (e.target === searchModalOverlay) {
                searchModalOverlay.classList.add('hidden');
                searchModalOverlay.classList.remove('flex');
            }
        });
    }

    if (openNewTimetableModalButton && newTimetableModalOverlay && closeNewTimetableModalButton) {
        openNewTimetableModalButton.addEventListener('click', () => {
            newTimetableModalOverlay.classList.remove('hidden');
            newTimetableModalOverlay.classList.add('flex');
        });
        closeNewTimetableModalButton.addEventListener('click', () => {
            newTimetableModalOverlay.classList.add('hidden');
            newTimetableModalOverlay.classList.remove('flex');
        });
    }

    // ================================
    //   ì‹œê°„í‘œ ê³µìœ  ì²´í¬ë°•ìŠ¤
    // ================================
    const shareChk = document.getElementById("chk-share-timetable");

    async function refreshShareCheckbox() {
        if (!shareChk) return;

        if (!currentYear || !currentSemester) {
            shareChk.checked = false;
            shareChk.disabled = true;
            return;
        }

        try {
            const res = await fetch(
                `/api/timetable/share-status/?year=${currentYear}&semester=${currentSemester}`,
                {
                    method: "GET",
                    credentials: "include",
                }
            );

            if (!res.ok) {
                console.error("ê³µìœ  ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:", res.status, res.statusText);
                shareChk.checked = false;
            } else {
                const data = await res.json();
                shareChk.checked = !!data.is_shared;
            }
        } catch (err) {
            console.error("ê³µìœ  ìƒíƒœ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:", err);
            shareChk.checked = false;
        }

        shareChk.disabled = false;
    }

    if (shareChk) {
        // ì²˜ìŒ ë¡œë“œ ì‹œì—ëŠ” í•™ê¸° ì„ íƒ ì—¬ë¶€ì— ë”°ë¼ ë¹„í™œì„±í™”/í™œì„±í™”
        shareChk.disabled = true;

        shareChk.addEventListener("change", async (e) => {
            if (!currentYear || !currentSemester) {
                alert("ë¨¼ì € ìƒë‹¨ì—ì„œ í•™ê¸°ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
                e.target.checked = !e.target.checked;
                return;
            }

            try {
                const res = await fetch("/api/timetable/share/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    credentials: "include",
                    body: JSON.stringify({
                        year: currentYear,
                        semester: currentSemester,
                        is_shared: e.target.checked,
                    }),
                });

                if (!res.ok) {
                    console.error("ì‹œê°„í‘œ ê³µìœ  ì„¤ì • ì‹¤íŒ¨:", res.status, res.statusText);
                    alert("ì‹œê°„í‘œ ê³µìœ  ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    e.target.checked = !e.target.checked;
                    return;
                }

                const data = await res.json();
                console.log("ê³µìœ  ìƒíƒœ ë³€ê²½ë¨:", data);
            } catch (err) {
                console.error("ì‹œê°„í‘œ ê³µìœ  ì„¤ì • ì¤‘ ì˜¤ë¥˜:", err);
                alert("ì‹œê°„í‘œ ê³µìœ  ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                e.target.checked = !e.target.checked;
            }
        });
    }

    // ================================
    //   ì‹œê°„í‘œ API ì—°ë™ ë¶€ë¶„
    // ================================
    const timetableTitle = document.getElementById("timetableTitle");
    const semesterSelect = document.getElementById("semesterSelect");

    let currentYear = null;
    let currentSemester = null;

    function formatSemesterLabel(year, semester) {
        return `${year}ë…„ ${semester}í•™ê¸°`;
    }

    function clearTimetableCells() {
        document.querySelectorAll('.timetable-cell').forEach(td => {
            td.innerHTML = '';
        });
    }

    // ğŸ”¹ í•™ê¸° ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    async function fetchSemesters() {
        try {
            const res = await fetch("/api/timetable/semesters/", {
                method: "GET",
                credentials: "include",
            });

            if (!res.ok) {
                console.error("í•™ê¸° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", res.status, res.statusText);
                return [];
            }

            const data = await res.json();

            if (Array.isArray(data)) {
                return data;
            }
            if (data && Array.isArray(data.semesters)) {
                return data.semesters;
            }
            return [];
        } catch (err) {
            console.error("í•™ê¸° ëª©ë¡ ë¡œë”© ì¤‘ ì˜¤ë¥˜:", err);
            return [];
        }
    }

    // ğŸ”¹ íŠ¹ì • ì—°ë„/í•™ê¸° ì‹œê°„í‘œ ë¡œë”©
    async function loadTimetable(year, semester) {
        if (!year || !semester) {
            clearTimetableCells();
            timetableTitle.textContent = "ì‹œê°„í‘œ";
            currentYear = null;
            currentSemester = null;
            await refreshShareCheckbox();
            return;
        }

        currentYear = year;
        currentSemester = semester;
        timetableTitle.textContent = formatSemesterLabel(year, semester);

        // âœ… í˜„ì¬ í•™ê¸° localStorageì— ì €ì¥
        localStorage.setItem(STORAGE_KEY_YEAR, String(year));
        localStorage.setItem(STORAGE_KEY_SEMESTER, String(semester));

        try {
            const res = await fetch(`/api/timetable/?year=${year}&semester=${semester}`, {
                method: "GET",
                credentials: "include",
            });

            clearTimetableCells();

            if (res.status === 404) {
                console.log("í•´ë‹¹ í•™ê¸° ì‹œê°„í‘œ ì—†ìŒ");
                await refreshShareCheckbox();
                return;
            }

            if (!res.ok) {
                console.error("ì‹œê°„í‘œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", res.status, res.statusText);
                await refreshShareCheckbox();
                return;
            }

            const data = await res.json();
            const entries = Array.isArray(data) ? data : (data.timetable || []);

            entries.forEach(item => {
                const selector = `.timetable-cell[data-day="${item.day}"][data-period="${item.period}"]`;
                const cell = document.querySelector(selector);
                if (!cell) return;

                const subject = item.subject || '';
                const classroom = item.classroom || '';
                const memo = item.memo || '';

                cell.innerHTML = `
                    <div class="font-medium text-xs sm:text-sm">${subject}</div>
                    <div class="text-[10px] sm:text-xs text-slate-500">
                        ${classroom ? classroom : ''}${memo ? (classroom ? ' Â· ' : '') + memo : ''}
                    </div>
                `;
            });
        } catch (err) {
            console.error("ì‹œê°„í‘œ ë¡œë”© ì¤‘ ì˜¤ë¥˜:", err);
        }

        await refreshShareCheckbox();
    }

    // ğŸ”¹ í•™ê¸° ì…€ë ‰íŠ¸ ì´ˆê¸°í™” (localStorage í™œìš©)
    async function initSemesterSelect() {
        const semesters = await fetchSemesters();

        semesterSelect.innerHTML = '<option value="">í•™ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

        semesters.forEach(({ year, semester, label }) => {
            const opt = document.createElement("option");
            opt.value = `${year}-${semester}`;
            opt.dataset.year = year;
            opt.dataset.semester = semester;
            opt.textContent = label || formatSemesterLabel(year, semester);
            semesterSelect.appendChild(opt);
        });

        // âœ… localStorageì— ì €ì¥ëœ ë§ˆì§€ë§‰ í•™ê¸° ìš°ì„  ì„ íƒ
        let initial = null;
        const savedYearStr = localStorage.getItem(STORAGE_KEY_YEAR);
        const savedSemStr = localStorage.getItem(STORAGE_KEY_SEMESTER);
        const savedYear = savedYearStr ? parseInt(savedYearStr, 10) : NaN;
        const savedSem = savedSemStr ? parseInt(savedSemStr, 10) : NaN;

        if (!Number.isNaN(savedYear) && !Number.isNaN(savedSem)) {
            initial = semesters.find(s => s.year === savedYear && s.semester === savedSem) || null;
        }

        // ì €ì¥ëœ ê²Œ ì—†ê±°ë‚˜, ê·¸ í•™ê¸°ê°€ ë” ì´ìƒ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í•™ê¸°ë¡œ
        if (!initial && semesters.length > 0) {
            initial = semesters[0];
        }

        if (initial) {
            const val = `${initial.year}-${initial.semester}`;
            semesterSelect.value = val;
            await loadTimetable(initial.year, initial.semester);
        } else {
            clearTimetableCells();
            timetableTitle.textContent = "ì‹œê°„í‘œ";
            currentYear = null;
            currentSemester = null;
            await refreshShareCheckbox();
        }

        semesterSelect.addEventListener("change", async (e) => {
            const value = e.target.value;
            if (!value) {
                clearTimetableCells();
                timetableTitle.textContent = "ì‹œê°„í‘œ";
                currentYear = null;
                currentSemester = null;
                await refreshShareCheckbox();
                return;
            }
            const [y, s] = value.split("-");
            const year = parseInt(y, 10);
            const semester = parseInt(s, 10);
            await loadTimetable(year, semester);
        });
    }

    // ğŸ”¹ ìƒˆ ì‹œê°„í‘œ ìƒì„± ë²„íŠ¼ â†’ í•´ë‹¹ ì—°ë„/í•™ê¸°ì˜ ë‚´ ì‹œê°„í‘œ ìƒì„±
    if (createTimetableButton && newTimetableModalOverlay && yearInput && semesterInput) {
        createTimetableButton.addEventListener('click', async () => {
            const year = parseInt(yearInput.value, 10);
            const semester = parseInt(semesterInput.value, 10);

            newTimetableModalOverlay.classList.add('hidden');
            newTimetableModalOverlay.classList.remove('flex');

            try {
                const res = await fetch("/api/timetable/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    credentials: "include",
                    body: JSON.stringify({
                        year: year,
                        semester: semester,
                        timetable: [],
                    }),
                });

                if (!res.ok) {
                    console.error("ìƒˆ ì‹œê°„í‘œ ìƒì„± ì‹¤íŒ¨:", res.status, res.statusText);
                    alert("ì‹œê°„í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    return;
                }

                const value = `${year}-${semester}`;
                let option = Array.from(semesterSelect.options).find(opt => opt.value === value);
                if (!option) {
                    option = document.createElement("option");
                    option.value = value;
                    option.dataset.year = year;
                    option.dataset.semester = semester;
                    option.textContent = formatSemesterLabel(year, semester);
                    semesterSelect.appendChild(option);
                }

                semesterSelect.value = value;
                await loadTimetable(year, semester);
            } catch (err) {
                console.error("ìƒˆ ì‹œê°„í‘œ ìƒì„± ì¤‘ ì˜¤ë¥˜:", err);
                alert("ì‹œê°„í‘œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }

    // ================================
    //   ìˆ˜ì—… ëª©ë¡ ê²€ìƒ‰ & ì¶”ê°€ ê¸°ëŠ¥
    // ================================
    async function searchCourses() {
        if (!currentYear || !currentSemester) {
            return;
        }
        const q = courseSearchInput ? courseSearchInput.value.trim() : "";

        const params = new URLSearchParams({
            year: currentYear,
            semester: currentSemester,
        });
        if (q) params.append('q', q);

        try {
            const res = await fetch(`/api/timetable/courses/?${params.toString()}`, {
                method: "GET",
                credentials: "include",
            });

            if (!res.ok) {
                console.error("ê³¼ëª© ê²€ìƒ‰ ì‹¤íŒ¨:", res.status, res.statusText);
                return;
            }

            const data = await res.json();
            renderCourseResults(Array.isArray(data) ? data : []);
        } catch (err) {
            console.error("ê³¼ëª© ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜:", err);
        }
    }

    function renderCourseResults(courses) {
        if (!courseSearchResults) return;
        courseSearchResults.innerHTML = "";

        if (!courses.length) {
            courseSearchResults.innerHTML = `
                <div class="py-4 text-sm text-slate-500 text-center">
                    ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            `;
            return;
        }

        courses.forEach(course => {
            const row = document.createElement("div");
            row.className = "flex items-center justify-between py-2";

            row.innerHTML = `
                <div class="text-sm text-left">
                    <div class="font-medium">${course.subject}</div>
                    <div class="text-xs text-slate-500">
                        ${course.professor || ""} Â· ${course.day} ${course.period}êµì‹œ
                        ${course.classroom ? " Â· " + course.classroom : ""}
                    </div>
                </div>
                <button class="ml-3 px-3 py-1 rounded-lg bg-blue-600 text-white text-xs font-semibold">
                    ì¶”ê°€
                </button>
            `;

            const addBtn = row.querySelector("button");
            addBtn.addEventListener("click", () => addCourseToTimetable(course));

            courseSearchResults.appendChild(row);
        });
    }

    async function addCourseToTimetable(course) {
        try {
            const res = await fetch("/api/timetable/add-course/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                credentials: "include",
                body: JSON.stringify({
                    course_id: course.id,
                    year: course.year,
                    semester: course.semester,
                }),
            });

            if (!res.ok) {
                console.error("ì‹œê°„í‘œì— ê³¼ëª© ì¶”ê°€ ì‹¤íŒ¨:", res.status, res.statusText);
                alert("ì‹œê°„í‘œì— ê³¼ëª©ì„ ì¶”ê°€í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                return;
            }

            await loadTimetable(currentYear, currentSemester);
        } catch (err) {
            console.error("ê³¼ëª© ì¶”ê°€ ì¤‘ ì˜¤ë¥˜:", err);
            alert("ê³¼ëª© ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }

    if (courseSearchButton) {
        courseSearchButton.addEventListener("click", (e) => {
            e.preventDefault();
            searchCourses();
        });
    }
    if (courseSearchInput) {
        courseSearchInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                searchCourses();
            }
        });
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
        initSemesterSelect();
    });
</script>


</body>
</html>
