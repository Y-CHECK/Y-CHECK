<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Y-CHECK · 메인</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print{.no-print{display:none!important}}
    </style>
</head>
<body class="min-h-screen bg-[#f7f9fc] text-slate-900 pb-24">

<!-- 공통 헤더 -->
<header class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <a href="main.html" class="flex items-center gap-3">
                <img src="../img/ycheck_logo.png" alt="Y-CHECK 로고" class="h-8 w-auto">
            </a>
            <div class="h-4 w-px bg-slate-200"></div>
            <div class="text-sm text-slate-600">연세대학교 졸업요건계산기</div>
        </div>
        <nav class="hidden sm:flex items-center gap-6 text-sm text-slate-600">
            <a href="calculator.html" class="hover:text-slate-900">계산기</a>
            <a href="timetable.html" class="hover:text-slate-900">시간표</a>
            <a href="sunbae.html" class="hover:text-slate-900">선배들의 발자취</a>
            <a href="mypage.html" class="hover:text-slate-900">마이페이지</a>
        </nav>
    </div>
</header>

<!-- 메인 대시보드 -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 py-8 grid grid-cols-1 lg:grid-cols-12 gap-6">

    <!-- 왼쪽(큰 영역) -->
    <section class="lg:col-span-9 space-y-6">

        <!-- 총 이수 진행도 (프로필과 높이 맞춤: h-40) -->
        <div class="bg-white rounded-2xl border shadow-sm p-6 h-40 flex flex-col justify-between">
            <div>
                <div class="text-sm text-slate-500">총 이수 진행도</div>
                <div class="mt-1 text-4xl font-extrabold tracking-tight">
                    123 <span class="text-slate-400">/</span> 133 <span class="text-slate-400">점</span>
                </div>
            </div>
            <div class="mt-4 flex items-center gap-3">
                <div class="flex-1 h-3 bg-slate-100 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-blue-200 via-blue-500 to-blue-800" style="width:92%"></div>
                </div>
                <div class="w-16 text-right text-lg font-bold text-emerald-600">92%</div>
            </div>
        </div>

        <!-- 성적비율 + 이수학점 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 성적 비율 : 도넛 그래프 -->
            <div class="bg-white rounded-2xl border shadow-sm p-5">
                <div class="text-sm text-slate-500 mb-3">성적 비율</div>
                <div class="grid grid-cols-2 gap-4 items-center">
                    <!-- 도넛 -->
                    <div class="flex justify-center">
                        <svg viewBox="0 0 120 120" class="w-32 h-32">
                            <!-- 바탕 원 -->
                            <circle cx="60" cy="60" r="40" fill="none" stroke="#e5edff" stroke-width="16" />
                            <!-- A+~A0 (파랑) -->
                            <circle
                                    cx="60" cy="60" r="40"
                                    fill="none"
                                    stroke="#2563eb"
                                    stroke-width="16"
                                    stroke-linecap="round"
                                    stroke-dasharray="118 999"
                                    stroke-dashoffset="-90"
                                    transform="rotate(-90 60 60)"
                            />
                            <!-- B+~B0 (핑크) -->
                            <circle
                                    cx="60" cy="60" r="40"
                                    fill="none"
                                    stroke="#f43f5e"
                                    stroke-width="16"
                                    stroke-linecap="round"
                                    stroke-dasharray="111 999"
                                    stroke-dashoffset="-208"
                                    transform="rotate(-90 60 60)"
                            />
                            <!-- C+~C0 (노랑) -->
                            <circle
                                    cx="60" cy="60" r="40"
                                    fill="none"
                                    stroke="#f59e0b"
                                    stroke-width="16"
                                    stroke-linecap="round"
                                    stroke-dasharray="18 999"
                                    stroke-dashoffset="-319"
                                    transform="rotate(-90 60 60)"
                            />
                            <!-- 가운데 흰색원으로 도넛 구멍 -->
                            <circle cx="60" cy="60" r="24" fill="white" />
                        </svg>
                    </div>
                    <!-- 범례 -->
                    <ul class="text-sm space-y-1">
                        <li class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full" style="background:#2563eb"></span>
                            <span>A+~A0</span><span class="ml-auto text-slate-500">47%</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full" style="background:#f43f5e"></span>
                            <span>B+~B0</span><span class="ml-auto text-slate-500">44%</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full" style="background:#f59e0b"></span>
                            <span>C+~C0</span><span class="ml-auto text-slate-500">7%</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full" style="background:#10b981"></span>
                            <span>D+~D0</span><span class="ml-auto text-slate-500">0%</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full" style="background:#64748b"></span>
                            <span>F</span><span class="ml-auto text-slate-500">0%</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 이수 학점(분류별) -->
            <div class="bg-white rounded-2xl border shadow-sm p-5 lg:col-span-2">
                <div class="text-sm text-slate-500 mb-3">이수 학점 (분류별)</div>

                <!-- 교양 -->
                <div class="mb-4">
                    <div class="flex justify-between text-sm">
                        <span class="font-medium text-slate-700">교양</span>
                        <span class="tabular-nums text-slate-700">52 / 52</span>
                    </div>
                    <div class="flex items-center gap-3 mt-2">
                        <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-blue-200 via-blue-500 to-blue-800" style="width:100%"></div>
                        </div>
                        <div class="w-10 text-right text-xs font-semibold text-slate-700">100%</div>
                    </div>
                </div>

                <!-- 전공필수 -->
                <div class="mb-4">
                    <div class="flex justify-between text-sm">
                        <span class="font-medium text-slate-700">전공필수</span>
                        <span class="tabular-nums text-slate-700">56 / 65</span>
                    </div>
                    <div class="flex items-center gap-3 mt-2">
                        <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-blue-200 via-blue-500 to-blue-800" style="width:86%"></div>
                        </div>
                        <div class="w-10 text-right text-xs font-semibold text-slate-700">86%</div>
                    </div>
                </div>

                <!-- 전공선택 -->
                <div>
                    <div class="flex justify-between text-sm">
                        <span class="font-medium text-slate-700">전공선택</span>
                        <span class="tabular-nums text-slate-700">15 / 16</span>
                    </div>
                    <div class="flex items-center gap-3 mt-2">
                        <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-blue-200 via-blue-500 to-blue-800" style="width:94%"></div>
                        </div>
                        <div class="w-10 text-right text-xs font-semibold text-slate-700">94%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 트랙별 과목추천 + 추천 이수과목 리스트 -->
        <div class="bg-white rounded-2xl border shadow-sm p-5">
            <div class="flex items-start justify-between mb-3">
                <div>
                    <div class="text-sm text-slate-500" id="track-label">트랙별 과목추천</div>
                    <div class="text-lg font-semibold" id="track-title">
                        내 관심 트랙 기반 추천 과목
                    </div>
                    <div class="mt-1 text-sm text-slate-600" id="track-desc">
                        로그인한 사용자의 관심/전공 트랙을 기준으로 과목을 추천해요.
                    </div>
                </div>
                <button class="text-xs text-blue-600 hover:underline">자세히 보기</button>
            </div>

            <div class="flex items-center justify-between mb-2">
                <div class="text-sm text-slate-500" id="track-subtitle">추천 이수과목 리스트</div>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                    <thead>
                    <tr class="text-left text-slate-500 border-b">
                        <th class="py-2 pr-4">우선순위</th>
                        <th class="py-2 pr-4">과목명</th>
                        <th class="py-2 pr-4">분류</th>
                        <th class="py-2 pr-4">학점</th>
                    </tr>
                    </thead>
                    <tbody id="track-course-body">
                    <!-- JS에서 채워짐 -->
                    <tr>
                        <td colspan="4" class="py-3 text-center text-slate-400">
                            추천 과목을 불러오는 중입니다...
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 수강 과목 리스트 -->
        <div class="bg-white rounded-2xl border shadow-sm p-5">
            <div class="flex items-center justify-between">
                <div class="text-sm text-slate-500">수강 과목 리스트</div>
            </div>
            <div class="overflow-x-auto mt-3">
                <table class="min-w-full text-sm">
                    <thead>
                    <tr class="text-left text-slate-500 border-b">
                        <th class="py-2 pr-4">과목명</th>
                        <th class="py-2 pr-4">분류</th>
                        <th class="py-2 pr-4">학점</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="border-b">
                        <td class="py-2 pr-4">자료구조</td>
                        <td class="py-2 pr-4">전필</td>
                        <td class="py-2 pr-4">3</td>
                    </tr>
                    <tr class="border-b">
                        <td class="py-2 pr-4">인공지능개론</td>
                        <td class="py-2 pr-4">전선</td>
                        <td class="py-2 pr-4">3</td>
                    </tr>
                    <tr>
                        <td class="py-2 pr-4">운영체제</td>
                        <td class="py-2 pr-4">전필</td>
                        <td class="py-2 pr-4">3</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </section>

    <!-- 오른쪽 사이드 -->
    <aside class="lg:col-span-3 flex flex-col space-y-6">

        <!-- 프로필 (총 이수 진행도와 높이 동일) -->
        <div class="bg-white rounded-2xl border shadow-sm p-5 h-40 flex flex-col justify-between">
            <div class="text-right text-xs text-slate-400">베타</div>
            <div>
                <!-- 이름 -->
                <div id="profile-name" class="text-lg font-semibold">김연세님</div>
                <!-- 학번 / 학기 -->
                <div id="profile-semester" class="text-sm text-slate-600">20220000 / 2학년</div>
                <!-- 학과 -->
                <div id="profile-major" class="text-sm text-slate-600">소프트웨어학부</div>
            </div>
        </div>

        <!-- 시간표 (세로 길이 줄임) -->
        <div class="bg-white rounded-2xl border shadow-sm p-5 min-h-[420px]">
            <div class="text-sm text-slate-500 mb-3">시간표</div>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-center border-collapse">
                    <thead>
                    <tr class="text-slate-600">
                        <th class="w-16 py-2 border border-slate-200"></th>
                        <th class="py-2 border border-slate-200">월</th>
                        <th class="py-2 border border-slate-200">화</th>
                        <th class="py-2 border border-slate-200">수</th>
                        <th class="py-2 border border-slate-200">목</th>
                        <th class="py-2 border border-slate-200">금</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 9 ~ 5시 -->
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">9</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">10</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">11</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">12</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">1</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">2</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">3</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">4</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    <tr>
                        <td class="py-2 border border-slate-200 text-slate-500">5</td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                        <td class="h-10 border border-slate-200"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 채플 카운트 -->
        <div class="bg-white rounded-2xl border shadow-sm p-5">
            <div class="text-sm text-slate-500 mb-3">채플 카운트</div>
            <div class="flex items-center gap-2">
                <input
                        id="chapel-input"
                        type="number"
                        min="0"
                        max="4"
                        value="0"
                        class="w-20 px-3 py-2 rounded-xl border text-sm text-center"
                />
                <span class="text-slate-500 text-sm">/ 4</span>
                <span id="chapel-percent" class="ml-auto text-sm font-semibold text-emerald-600">0%</span>
            </div>
            <div class="mt-3 h-2 bg-slate-100 rounded-full overflow-hidden">
                <div
                        id="chapel-bar"
                        class="h-full bg-gradient-to-r from-blue-200 via-blue-500 to-blue-800"
                        style="width:0%"
                ></div>
            </div>
        </div>

        <!-- 졸업 요구사항 메모 -->
        <div class="bg-white rounded-2xl border shadow-sm p-5">
            <div class="text-sm text-slate-500 mb-2">졸업 요구사항 (메모)</div>
            <textarea
                    id="memo-text"
                    class="w-full h-40 rounded-2xl border px-3 py-2 text-sm resize-none"
                    placeholder="- 졸업작품 / 졸업논문 중 택1&#10;- 토익 800+"
            >- 졸업작품 / 졸업논문 중 택1
- 토익 800+</textarea>
        </div>

    </aside>
</main>

<!-- 공통 푸터 (고정) -->
<footer class="fixed bottom-0 inset-x-0 bg-white border-t">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-start justify-between">
        <div class="flex items-start gap-4">
            <img src="../img/ycheck_logo.png" alt="Y-CHECK 로고" class="h-6 w-auto" />
            <div class="space-y-1 text-sm text-slate-600 leading-relaxed">
                <div>강원특별자치도 원주시 흥업면 연세대길 1 창조관</div>
                <div>TEL) 033-123-4567</div>
                <div>EMAIL: YCHECK@gmail.com</div>
            </div>
        </div>
        <div class="flex items-center gap-6 text-sm text-slate-600">
            <span class="hidden sm:block h-6 w-px bg-slate-200"></span>
            <span>만든이들</span>
            <span>문의하기</span>
        </div>
    </div>
</footer>

<!-- 채플 / 메모 로컬 저장 스크립트 -->
<script>
    const STATE_KEY = "ycheck-main-state-v1";

    const chapelInput = document.getElementById("chapel-input");
    const chapelBar = document.getElementById("chapel-bar");
    const chapelPercent = document.getElementById("chapel-percent");
    const memoText = document.getElementById("memo-text");

    function loadState() {
        try {
            const raw = localStorage.getItem(STATE_KEY);
            if (!raw) return;
            const state = JSON.parse(raw);
            if (typeof state.chapel === "number" && chapelInput) {
                chapelInput.value = state.chapel;
            }
            if (typeof state.memo === "string" && memoText) {
                memoText.value = state.memo;
            }
        } catch (e) {
            console.warn("state load error", e);
        }
    }

    function saveState() {
        try {
            const data = {
                chapel: chapelInput ? Number(chapelInput.value || 0) : 0,
                memo: memoText ? memoText.value : ""
            };
            localStorage.setItem(STATE_KEY, JSON.stringify(data));
        } catch (e) {
            console.warn("state save error", e);
        }
    }

    function updateChapelUI() {
        if (!chapelInput || !chapelBar || !chapelPercent) return;
        const max = 4;
        let v = Number(chapelInput.value || 0);
        if (!Number.isFinite(v)) v = 0;
        if (v < 0) v = 0;
        if (v > max) v = max;
        chapelInput.value = v;
        const pct = Math.round((v / max) * 100);
        chapelBar.style.width = pct + "%";
        chapelPercent.textContent = pct + "%";
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadState();
        updateChapelUI();

        if (chapelInput) {
            chapelInput.addEventListener("input", () => {
                updateChapelUI();
                saveState();
            });
        }
        if (memoText) {
            memoText.addEventListener("input", () => {
                saveState();
            });
        }
    });
</script>

<!-- 트랙별 과목추천 스크립트 -->
<script>
    async function loadTrackRecommend() {
        const titleEl = document.getElementById("track-title");
        const descEl = document.getElementById("track-desc");
        const bodyEl = document.getElementById("track-course-body");

        if (!bodyEl) return;

        // 초기 상태
        bodyEl.innerHTML = `
        <tr>
          <td colspan="4" class="py-3 text-center text-slate-400">
            추천 과목을 불러오는 중입니다...
          </td>
        </tr>
        `;

        try {
            const resp = await fetch("http://localhost:8000/api/track-recommend/", {
                method: "GET",
                credentials: "include",
            });

            if (!resp.ok) {
                console.warn("track-recommend API 실패:", resp.status);
                bodyEl.innerHTML = `
                <tr>
                  <td colspan="4" class="py-3 text-center text-slate-400">
                    추천 정보를 불러오지 못했습니다. (code: ${resp.status})
                  </td>
                </tr>
                `;
                return;
            }

            const data = await resp.json();

            // 관심 트랙이 없는 경우
            if (!data.has_track) {
                titleEl.textContent = "관심 트랙이 설정되어 있지 않습니다.";
                descEl.textContent = data.message || "마이페이지에서 관심 전공/분야를 먼저 선택해 주세요.";
                bodyEl.innerHTML = `
                <tr>
                  <td colspan="4" class="py-3 text-center text-slate-400">
                    추천할 과목이 없습니다.
                  </td>
                </tr>
                `;
                return;
            }

            const trackName = data.track_name || data.track_key || "내 트랙";
            titleEl.textContent = `추천 트랙: ${trackName}`;
            descEl.textContent = data.description || "이 트랙의 전필/핵심 과목 중 아직 듣지 않은 과목을 추천합니다.";

            const courses = data.courses || [];
            if (!courses.length) {
                bodyEl.innerHTML = `
                <tr>
                  <td colspan="4" class="py-3 text-center text-slate-400">
                    추천할 과목이 없습니다.
                  </td>
                </tr>
                `;
                return;
            }

            bodyEl.innerHTML = "";
            courses.forEach((course, idx) => {
                const tr = document.createElement("tr");
                if (idx !== courses.length - 1) tr.className = "border-b";
                tr.innerHTML = `
                <td class="py-2 pr-4">${idx + 1}</td>
                <td class="py-2 pr-4">${course.name}</td>
                <td class="py-2 pr-4">${course.type || "트랙전필"}</td>
                <td class="py-2 pr-4">${course.credits}</td>
                `;
                bodyEl.appendChild(tr);
            });
        } catch (e) {
            console.error("track-recommend 요청 중 오류:", e);
            bodyEl.innerHTML = `
            <tr>
              <td colspan="4" class="py-3 text-center text-red-500">
                추천 정보를 불러오는 중 오류가 발생했습니다.
              </td>
            </tr>
            `;
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadTrackRecommend();
    });
</script>
</body>
</html>
